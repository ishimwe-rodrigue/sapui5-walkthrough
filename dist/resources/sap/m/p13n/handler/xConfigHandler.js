/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine","sap/m/p13n/modules/xConfigAPI"],(e,t)=>{"use strict";const n={};const a=(e,t)=>{const n=t=>{if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};function r(t,n){if(t.isA){e.getInstance().trace(t,{selectorElement:t,changeSpecificData:{changeType:n.getChangeType(),content:n.getContent()}});if(!t._pPendingModification){t._pPendingModification=e.getInstance().waitForChanges(t).then(()=>{e.getInstance().fireStateChange(t);e.getInstance().clearTrace(t);delete t._pPendingModification})}}}function g(e){const t=["add","remove","move","set"];return t.find(t=>e.indexOf(t)===0)}function o(e){const t={add:"remove",remove:"add",move:"move",set:"set"};const n=g(e);return t[n]}n.createHandler=t=>{if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}const n=t.property;let i;return{changeHandler:{applyChange:function(o,s,c){const p=o.getContent().persistenceIdentifier;const u=e.getInstance().getController(s,o.getChangeType(),p);if(p&&u.getPersistenceIdentifier()!==p){return Promise.resolve(false)}return a(s,()=>e.getInstance().readXConfig(s,{propertyBag:c}).then(a=>{const r=g(o.getChangeType());i=o.getContent().targetAggregation;const u={key:o.getContent().key};if(p){u.persistenceIdentifier=p}if(r!=="set"){u.value=r!=="add"}else{u.value=null}const f=e.getInstance().getController(s,o.getChangeType());const d=f?.getCurrentState();let y;if(d&&d instanceof Array){y=d.find((e,t)=>e.key===o.getContent().key)}u.targetAggregation=o.getContent().targetAggregation;if(y){u.index=d.indexOf(y)}if(a&&a.aggregations&&a.aggregations[i]&&a.aggregations[i][o.getContent().key]&&a.aggregations[i][o.getContent().key][n]){u.value=a.aggregations[i][o.getContent().key][n]}o.setRevertData(u);const l={property:n,key:o.getContent().key,value:o.getContent(),operation:r,changeType:o.getChangeType(),propertyBag:c,markAsModified:true};if(t.aggregationBased){l.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(s,l)}).then(e=>{if(!e){return}r(s,o)}))},completeChangeContent:function(e,t,n){},revertChange:function(a,g,s){const c=o(a.getChangeType());i=a.getContent().targetAggregation;const p={controlMeta:{aggregation:i,property:n},property:n,operation:c,changeType:a.getChangeType(),key:a.getRevertData().key,value:a.getRevertData(),propertyBag:s};if(t.aggregationBased){p.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(g,p).then(e=>{if(!e){return}a.resetRevertData();r(g,a)})}},layers:{USER:true}}};return n});
//# sourceMappingURL=xConfigHandler.js.map